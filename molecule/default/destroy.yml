- name: Destroy
  hosts: localhost
  connection: local
  become: true # docker operation requires sudo privileges
  become_user: "{{ lookup('ansible.builtin.env', 'USER') }}"
  gather_facts: false
  no_log: "{{ molecule_no_log }}"
  tasks:
    - name: Destroy test containers
      community.docker.docker_container:
        name: "{{ hostvars[item].ansible_host }}"
        force_kill: true
        state: absent
      loop: "{{ groups['all'] }}"

    - name: Destroy container network
      community.docker.docker_network:
        name: "{{ docker_network_name }}"
        state: absent
